<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CEO战略决策智能训练系统 - 华博育士(上海)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --primary: #3a7bd5;
            --secondary: #00d2ff;
            --success: #4CAF50;
            --danger: #F44336;
            --warning: #FFC107;
            --dark: #212121;
            --light: #f5f7fa;
            --hby-orange: #FF6B35;
            --hby-blue: #004E89;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 100%;
            padding: 0;
            position: relative;
        }
        
        .brand-header {
            background: linear-gradient(135deg, var(--hby-blue), var(--hby-orange));
            color: white;
            padding: 15px;
            text-align: center;
            position: relative;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 100;
        }
        
        .brand-logo {
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .brand-logo img {
            height: 30px;
            margin-right: 10px;
        }
        
        .copyright {
            font-size: 0.7rem;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        .game-header {
            background-color: white;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .game-header h1 {
            color: var(--hby-blue);
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .game-header p {
            color: #666;
            font-size: 0.9rem;
        }
        
        .game-area {
            display: flex;
            flex-direction: column;
            min-height: calc(100vh - 150px);
        }
        
        .tab-container {
            display: flex;
            background-color: white;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .tab-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: none;
            font-weight: bold;
            color: #666;
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            color: var(--hby-orange);
        }
        
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--hby-orange);
        }
        
        .tab-content {
            display: none;
            flex: 1;
            padding: 15px;
            background-color: white;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* 模拟训练页样式 */
        .company-visual {
            height: 180px;
            background: linear-gradient(to bottom, #f5f7fa, #e0e6eb);
            display: flex;
            justify-content: center;
            align-items: flex-end;
            position: relative;
            overflow: hidden;
            margin-bottom: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .building {
            width: 70px;
            background: linear-gradient(to bottom, #74b9ff, #0984e3);
            margin: 0 5px;
            position: relative;
            transition: all 0.5s ease;
            border-radius: 5px 5px 0 0;
        }
        
        .main-tower {
            width: 90px;
            background: linear-gradient(to bottom, #fdcb6e, #e17055);
            z-index: 2;
        }
        
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .stat-card {
            background-color: white;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--hby-blue);
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.7rem;
            color: #666;
        }

        /* 个性化学习推荐链接样式：默认无下划线，悬停时有（针对含.resource-badge的推荐项内的链接） */
        .recommendation-item a, .resource-item a {
            text-decoration: none;
            color: var(--hby-blue); /* 保持链接颜色一致 */
        }
        a:hover {
            text-decoration: underline;
        }
        
        .scenario-card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-left: 4px solid var(--hby-orange);
        }
        
        .scenario-title {
            color: var(--hby-blue);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .scenario-title i {
            margin-right: 8px;
            color: var(--hby-orange);
        }
        
        .decision-options {
            margin-bottom: 15px;
        }
        
        .option-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, var(--hby-blue), var(--primary));
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(58, 123, 213, 0.2);
        }
        
        .option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(58, 123, 213, 0.3);
        }
        
        .option-cost {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        /* 诊断分析页样式 */
        .diagnosis-card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .section-title {
            color: var(--hby-blue);
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }
        
        .weakness-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f5f5f5;
        }
        
        .weakness-icon {
            width: 30px;
            height: 30px;
            background-color: #FFEEEE;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            color: var(--danger);
        }
        
        .weakness-text {
            flex: 1;
        }
        
        .weakness-title {
            font-weight: bold;
            margin-bottom: 3px;
        }
        
        .weakness-desc {
            font-size: 0.8rem;
            color: #666;
        }
        
        .recommendation-card {
            background-color: #F5F9FF;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--hby-blue);
        }
        
        .recommendation-item {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #ddd;
        }
        
        .recommendation-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .resource-badge {
            display: inline-block;
            padding: 3px 8px;
            background-color: var(--hby-orange);
            color: white;
            border-radius: 10px;
            font-size: 0.7rem;
            margin-right: 5px;
        }
        
        /* 学习中心样式 */
        .knowledge-card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .knowledge-category {
            margin-bottom: 15px;
        }
        
        .category-title {
            color: var(--hby-blue);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .category-title i {
            margin-right: 8px;
            color: var(--hby-orange);
        }
        
        .resource-list {
            list-style: none;
        }
        
        .resource-item {
            padding: 8px 0;
            border-bottom: 1px solid #f5f5f5;
            display: flex;
            align-items: center;
        }
        
        .resource-icon {
            margin-right: 10px;
            color: var(--hby-orange);
        }
        
        .progress-container {
            margin-top: 15px;
        }
        
        .progress-title {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .progress-bar {
            height: 8px;
            background-color: #eee;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--hby-orange), #FF9E1F);
            border-radius: 4px;
            transition: width 0.5s;
        }
        
        /* 测试题库样式 */
        .quiz-card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .quiz-question {
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .quiz-options {
            margin-bottom: 15px;
        }
        
        .quiz-option {
            display: block;
            padding: 10px;
            margin-bottom: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .quiz-option:hover {
            background-color: #f5f5f5;
        }
        
        .quiz-option.selected {
            border-color: var(--hby-orange);
            background-color: #FFF5E6;
        }
        
        .quiz-option.correct {
            border-color: var(--success);
            background-color: #E8F5E9;
        }
        
        .quiz-option.incorrect {
            border-color: var(--danger);
            background-color: #FFEBEE;
        }
        
        .quiz-explanation {
            padding: 10px;
            background-color: #F5F9FF;
            border-radius: 6px;
            margin-top: 10px;
            display: none;
        }
        
        .quiz-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }
        
        .quiz-btn {
    padding: 8px 15px;
    border: none;
    border-radius: 20px;
    background: linear-gradient(135deg, var(--hby-blue), var(--primary));
    color: white;
    font-weight: bold;
    cursor: pointer;
}

/* 新增简答题样式 */
.essay-answer {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 6px;
    margin: 10px 0;
}

/* 调整判断题选项间距 */
.judgement-options .quiz-option {
    margin: 10px 0;
    padding: 12px;
}
        
        /* 能力档案样式 */
        .profile-card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .skill-radar {
            height: 250px;
            margin-bottom: 15px;
        }
        
        .skill-level {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .skill-name {
            width: 100px;
            font-size: 0.9rem;
        }
        
        .skill-bar {
            flex: 1;
            height: 10px;
            background-color: #eee;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .skill-progress {
            height: 100%;
            background: linear-gradient(90deg, var(--hby-orange), #FF9E1F);
            border-radius: 5px;
        }
        
        .skill-value {
            width: 40px;
            text-align: right;
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--hby-blue);
        }
        
        /* 反馈弹窗 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            animation: modalFadeIn 0.3s;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-header {
            padding: 15px;
            border-bottom: 1px solid #eee;
            position: relative;
        }
        
        .modal-title {
            color: var(--hby-blue);
            font-size: 1.2rem;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: #999;
        }
        
        .modal-body {
            padding: 15px;
        }
        
        .modal-footer {
            padding: 15px;
            border-top: 1px solid #eee;
            text-align: right;
        }
        
        /* 响应式调整 */
        @media (min-width: 768px) {
            .game-area {
                flex-direction: row;
                align-items: flex-start;
            }
            
            .tab-container {
                flex-direction: column;
                width: 120px;
                border-bottom: none;
                border-right: 1px solid #e0e0e0;
            }
            
            .tab-btn {
                padding: 15px;
                text-align: left;
                border-bottom: 1px solid #e0e0e0;
            }
            
            .tab-btn.active::after {
                bottom: 0;
                left: auto;
                right: -1px;
                width: 3px;
                height: 100%;
            }
            
            .tab-content {
                flex: 1;
            }
        }
        
        /* 动画效果 */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        /* 徽章效果 */
        .badge {
            display: inline-block;
            padding: 3px 8px;
            background-color: var(--hby-orange);
            color: white;
            border-radius: 10px;
            font-size: 0.7rem;
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="brand-header">
            <div class="brand-logo">
                <img src="/static/logo.jpg" alt="华博育士logo" style="width: 40px; height: auto;">
                华博育士(上海)
            </div>
            <div class="copyright">© 2023 华博育士(上海) 版权所有</div>
        </div>
        
        <div class="game-header">
            <h1>CEO战略决策智能训练系统</h1>
            <p>专业版 - 提升高管团队战略思维与决策能力</p>
        </div>
        
        <div class="game-area">
            <div class="tab-container">
                <button class="tab-btn active" onclick="switchTab('simulation')">
                    <i>🏢</i> 商业模拟
                </button>
                <button class="tab-btn" onclick="switchTab('diagnosis')">
                    <i>🔍</i> 智能诊断
                </button>
                <button class="tab-btn" onclick="switchTab('knowledge')">
                    <i>📚</i> 学习中心
                </button>
                <button class="tab-btn" onclick="switchTab('quiz')">
                    <i>✍️</i> 能力测试
                </button>
                <button class="tab-btn" onclick="switchTab('profile')">
                    <i>📊</i> 能力档案
                </button>
            </div>
            
            <!-- 商业模拟页 -->
            <div class="tab-content active" id="simulationTab">
                <div class="company-visual" id="companyVisual">
                    <div class="building" style="height: 60px;"></div>
                    <div class="building main-tower" style="height: 100px;"></div>
                    <div class="building" style="height: 50px;"></div>
                </div>
                
                <div class="stats-bar">
                    <div class="stat-card">
                        <div class="stat-value" id="marketShare">32%</div>
                        <div class="stat-label">市场份额</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="revenue">¥1.2B</div>
                        <div class="stat-label">季度营收</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="profit">¥180M</div>
                        <div class="stat-label">季度利润</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="riskIndex">45</div>
                        <div class="stat-label">风险指数</div>
                    </div>



                    <script>
                        // 新增抽题逻辑
                        async function loadQuiz() {
                            try {
                                const response = await fetch('/api/random-questions');
                                const questions = await response.json();
                                renderQuiz(questions);
                            } catch (error) {
                                console.error('获取题目失败:', error);
                                quizContainer.innerHTML = '<div class="error-msg">题目加载失败，请刷新页面重试</div>';
                            }
                        }

                        function renderQuiz(questions) {
                            const container = document.getElementById('quizContainer');
                            container.innerHTML = ''; // 清空原有内容
                            
                            questions.forEach((q, index) => {
                                const questionDiv = document.createElement('div');
                                questionDiv.className = 'quiz-question';
                                questionDiv.innerHTML = `
                                    <div class="question-content">${index + 1}. ${q.question_content}</div>
                                    <div class="quiz-options">${renderOptions(q)}</div>
                                    <div class="quiz-explanation" style="display:none;"></div>
                                `;
                                container.appendChild(questionDiv);
                            });
                        }

                        function renderOptions(q) {
                            let optionsHtml = '';
                            if (q.question_type === '判断题') {
                                optionsHtml = `
                                    <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                        <input type="radio" name="q${q.id}" value="正确"> 正确
                                    </label>
                                    <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                        <input type="radio" name="q${q.id}" value="错误"> 错误
                                    </label>
                                `;
                            } else {
                                Object.entries(q.options).forEach(([key, value]) => {
                                    optionsHtml += `
                                        <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                            <input type="radio" name="q${q.id}" value="${key}"> ${value}
                                        </label>
                                    `;
                                });
                            }
                            return optionsHtml;
                        }

                        // 初始化加载题目
                        document.querySelector('[onclick="switchTab(\'quiz\')"]').addEventListener('click', loadQuiz);
                    </script>
                </div>
                
                <div class="scenario-card">
                    <div class="scenario-title">
                        <i>📌</i> 当前商业挑战
                    </div>
                    <div class="scenario-text" id="scenarioText">
                        公司面临市场份额连续三个季度下滑，竞争对手推出了颠覆性产品，董事会要求立即采取行动扭转局面。作为CEO，你需要带领高管团队做出关键战略决策。
                    </div>



                    <script>
                        // 新增抽题逻辑
                        async function loadQuiz() {
                            try {
                                const response = await fetch('/api/random-questions');
                                const questions = await response.json();
                                renderQuiz(questions);
                            } catch (error) {
                                console.error('获取题目失败:', error);
                                quizContainer.innerHTML = '<div class="error-msg">题目加载失败，请刷新页面重试</div>';
                            }
                        }

                        function renderQuiz(questions) {
                            const container = document.getElementById('quizContainer');
                            container.innerHTML = ''; // 清空原有内容
                            
                            questions.forEach((q, index) => {
                                const questionDiv = document.createElement('div');
                                questionDiv.className = 'quiz-question';
                                questionDiv.innerHTML = `
                                    <div class="question-content">${index + 1}. ${q.question_content}</div>
                                    <div class="quiz-options">${renderOptions(q)}</div>
                                    <div class="quiz-explanation" style="display:none;"></div>
                                `;
                                container.appendChild(questionDiv);
                            });
                        }

                        function renderOptions(q) {
                            let optionsHtml = '';
                            if (q.question_type === '判断题') {
                                optionsHtml = `
                                    <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                        <input type="radio" name="q${q.id}" value="正确"> 正确
                                    </label>
                                    <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                        <input type="radio" name="q${q.id}" value="错误"> 错误
                                    </label>
                                `;
                            } else {
                                Object.entries(q.options).forEach(([key, value]) => {
                                    optionsHtml += `
                                        <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                            <input type="radio" name="q${q.id}" value="${key}"> ${value}
                                        </label>
                                    `;
                                });
                            }
                            return optionsHtml;
                        }

                        // 初始化加载题目
                        document.querySelector('[onclick="switchTab(\'quiz\')"]').addEventListener('click', loadQuiz);
                    </script>
                </div>
                
                <div class="decision-options">
                    <button class="option-btn" onclick="makeDecision(1)">
                        加大研发投入
                        <span class="option-cost">¥15,000,000</span>
                    </button>
                    <button class="option-btn" onclick="makeDecision(2)">
                        并购竞争对手
                        <span class="option-cost">¥30,000,000</span>
                    </button>
                    <button class="option-btn" onclick="makeDecision(3)">
                        优化现有产品线
                        <span class="option-cost">¥5,000,000</span>
                    </button>
                    <button class="option-btn" onclick="makeDecision(4)">
                        开拓新兴市场
                        <span class="option-cost">¥20,000,000</span>
                    </button>
                </div>
                
                <div class="scenario-card">
                    <div class="scenario-title">
                        <i>📝</i> 决策日志
                    </div>
                    <div id="decisionLog" style="max-height: 150px; overflow-y: auto;">
                        <!-- 决策日志将通过JS动态填充 -->
                    </div>



                    <script>
                        // 新增抽题逻辑
                        async function loadQuiz() {
                            try {
                                const response = await fetch('/api/random-questions');
                                const questions = await response.json();
                                renderQuiz(questions);
                            } catch (error) {
                                console.error('获取题目失败:', error);
                                quizContainer.innerHTML = '<div class="error-msg">题目加载失败，请刷新页面重试</div>';
                            }
                        }

                        function renderQuiz(questions) {
                            const container = document.getElementById('quizContainer');
                            container.innerHTML = ''; // 清空原有内容
                            
                            questions.forEach((q, index) => {
                                const questionDiv = document.createElement('div');
                                questionDiv.className = 'quiz-question';
                                questionDiv.innerHTML = `
                                    <div class="question-content">${index + 1}. ${q.question_content}</div>
                                    <div class="quiz-options">${renderOptions(q)}</div>
                                    <div class="quiz-explanation" style="display:none;"></div>
                                `;
                                container.appendChild(questionDiv);
                            });
                        }

                        function renderOptions(q) {
                            let optionsHtml = '';
                            if (q.question_type === '判断题') {
                                optionsHtml = `
                                    <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                        <input type="radio" name="q${q.id}" value="正确"> 正确
                                    </label>
                                    <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                        <input type="radio" name="q${q.id}" value="错误"> 错误
                                    </label>
                                `;
                            } else {
                                Object.entries(q.options).forEach(([key, value]) => {
                                    optionsHtml += `
                                        <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                            <input type="radio" name="q${q.id}" value="${key}"> ${value}
                                        </label>
                                    `;
                                });
                            }
                            return optionsHtml;
                        }

                        // 初始化加载题目
                        document.querySelector('[onclick="switchTab(\'quiz\')"]').addEventListener('click', loadQuiz);
                    </script>
                </div>
            </div>
            
            <!-- 智能诊断页 -->
            <div class="tab-content" id="diagnosisTab">
                <div class="diagnosis-card">
                    <h3 class="section-title">决策弱点诊断</h3>

                    <script>
                        // 存储最近5次决策记录的数组
                        let decisionHistory = [];

                        // 记录新决策的函数（需在实际决策操作后调用）
                        function recordDecision(metrics) {
                            decisionHistory.push(metrics);
                            if (decisionHistory.length > 5) decisionHistory.shift(); // 保持最近5条
                            updateWeaknessDiagnosis(); // 记录后立即更新诊断
                        }

                        // 更新弱点诊断内容的核心函数
                        function updateWeaknessDiagnosis() {
                            // 风险控制不足诊断（示例：统计风险指数>60的次数）
                            const riskExceedCount = decisionHistory.filter(d => d.riskIndex > 60).length;
                            document.getElementById('riskControlDesc').textContent = `过去${decisionHistory.length}次决策中有${riskExceedCount}次风险指数超过60，显示风险偏好较高`;

                            // 长期战略缺失诊断（示例：计算研发投入平均占比）
                            const avgRND = decisionHistory.reduce((sum, d) => sum + d.rndRatio, 0) / (decisionHistory.length || 1);
                            document.getElementById('strategyMissingDesc').textContent = `研发投入占比平均为${(avgRND*100).toFixed(1)}%，低于行业标杆企业${(30 - avgRND*100).toFixed(1)}个百分点`;

                            // 团队协同不足诊断（示例：计算协同效率平均分）
                            const avgCollab = decisionHistory.reduce((sum, d) => sum + d.collabScore, 0) / (decisionHistory.length || 1);
                            document.getElementById('collaborationDesc').textContent = `跨部门决策执行效率平均评分为${avgCollab.toFixed(0)}/100`;
                        }
                    </script>
                    
                    <div class="weakness-item">
                        <div class="weakness-icon">
                            <i>⚠️</i>
                        </div>
                        <div class="weakness-text">
                            <div class="weakness-title">风险控制不足</div>
                            <div class="weakness-desc" id="riskControlDesc">过去5次决策中有3次风险指数超过60，显示风险偏好较高</div>
                        </div>
                    </div>
                    
                    <div class="weakness-item">
                        <div class="weakness-icon">
                            <i>⚠️</i>
                        </div>
                        <div class="weakness-text">
                            <div class="weakness-title">长期战略缺失</div>
                            <div class="weakness-desc" id="strategyMissingDesc">研发投入占比低于行业标杆企业15个百分点</div>
                        </div>
                    </div>
                    
                    <div class="weakness-item">
                        <div class="weakness-icon">
                            <i>⚠️</i>
                        </div>
                        <div class="weakness-text">
                            <div class="weakness-title">团队协同不足</div>
                            <div class="weakness-desc" id="collaborationDesc">跨部门决策执行效率评分仅为68/100</div>
                        </div>
                    </div>



                    <script>
                        // 新增抽题逻辑
                        async function loadQuiz() {
                            try {
                                const response = await fetch('/api/random-questions');
                                const questions = await response.json();
                                renderQuiz(questions);
                            } catch (error) {
                                console.error('获取题目失败:', error);
                                quizContainer.innerHTML = '<div class="error-msg">题目加载失败，请刷新页面重试</div>';
                            }
                        }

                        function renderQuiz(questions) {
                            const container = document.getElementById('quizContainer');
                            container.innerHTML = ''; // 清空原有内容
                            
                            questions.forEach((q, index) => {
                                const questionDiv = document.createElement('div');
                                questionDiv.className = 'quiz-question';
                                questionDiv.innerHTML = `
                                    <div class="question-content">${index + 1}. ${q.question_content}</div>
                                    <div class="quiz-options">${renderOptions(q)}</div>
                                    <div class="quiz-explanation" style="display:none;"></div>
                                `;
                                container.appendChild(questionDiv);
                            });
                        }

                        function renderOptions(q) {
                            let optionsHtml = '';
                            if (q.question_type === '判断题') {
                                optionsHtml = `
                                    <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                        <input type="radio" name="q${q.id}" value="正确"> 正确
                                    </label>
                                    <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                        <input type="radio" name="q${q.id}" value="错误"> 错误
                                    </label>
                                `;
                            } else {
                                Object.entries(q.options).forEach(([key, value]) => {
                                    optionsHtml += `
                                        <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                            <input type="radio" name="q${q.id}" value="${key}"> ${value}
                                        </label>
                                    `;
                                });
                            }
                            return optionsHtml;
                        }

                        // 初始化加载题目
                        document.querySelector('[onclick="switchTab(\'quiz\')"]').addEventListener('click', loadQuiz);
                    </script>
                </div>
                
                <div class="recommendation-card">
                    <h3 class="section-title">个性化学习推荐</h3>
                    
                    <div class="recommendation-item">
                        <span class="resource-badge">书籍</span>
                        <a href="https://zhuanlan.zhihu.com/p/612603711" target="_blank">《黑天鹅：如何应对不可预知的未来》- 纳西姆·尼古拉斯·塔勒布</a>
                    </div>
                    
                    <div class="recommendation-item">
                        <span class="resource-badge">方法论</span>
                        <a href="https://example.com/scenario-planning" target="_blank">情景规划训练：应对不确定性的战略工具</a>
                    </div>
                    
                    <div class="recommendation-item">
                        <span class="resource-badge">课程</span>
                        <a href="https://example.com/risk-management-course" target="_blank">"战略风险管理" - 华博育士高管课程</a>
                    </div>
                    
                    <div class="recommendation-item">
                        <span class="resource-badge">工具</span>
                        <a href="https://example.com/decision-matrix" target="_blank">风险-收益平衡决策矩阵模板</a>
                    </div>



                    <script>
                        // 新增抽题逻辑
                        async function loadQuiz() {
                            try {
                                const response = await fetch('/api/random-questions');
                                const questions = await response.json();
                                renderQuiz(questions);
                            } catch (error) {
                                console.error('获取题目失败:', error);
                                quizContainer.innerHTML = '<div class="error-msg">题目加载失败，请刷新页面重试</div>';
                            }
                        }

                        function renderQuiz(questions) {
                            const container = document.getElementById('quizContainer');
                            container.innerHTML = ''; // 清空原有内容
                            
                            questions.forEach((q, index) => {
                                const questionDiv = document.createElement('div');
                                questionDiv.className = 'quiz-question';
                                questionDiv.innerHTML = `
                                    <div class="question-content">${index + 1}. ${q.question_content}</div>
                                    <div class="quiz-options">${renderOptions(q)}</div>
                                    <div class="quiz-explanation" style="display:none;"></div>
                                `;
                                container.appendChild(questionDiv);
                            });
                        }

                        function renderOptions(q) {
                            let optionsHtml = '';
                            if (q.question_type === '判断题') {
                                optionsHtml = `
                                    <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                        <input type="radio" name="q${q.id}" value="正确"> 正确
                                    </label>
                                    <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                        <input type="radio" name="q${q.id}" value="错误"> 错误
                                    </label>
                                `;
                            } else {
                                Object.entries(q.options).forEach(([key, value]) => {
                                    optionsHtml += `
                                        <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                            <input type="radio" name="q${q.id}" value="${key}"> ${value}
                                        </label>
                                    `;
                                });
                            }
                            return optionsHtml;
                        }

                        // 初始化加载题目
                        document.querySelector('[onclick="switchTab(\'quiz\')"]').addEventListener('click', loadQuiz);
                    </script>
                </div>
                
                <div class="diagnosis-card">
                    <h3 class="section-title">改进计划</h3>
                    <p>基于您的决策模式分析，建议采取以下改进措施：</p>
                    <ol style="margin-top: 10px; padding-left: 20px;">
                        <li style="margin-bottom: 8px; display: flex; align-items: center;"><input type="checkbox" class="improvement-checkbox" onchange="updateProgress()"><span style="margin-left: 8px;">完成《黑天鹅》阅读并提交读书笔记</span></li>
                        <li style="margin-bottom: 8px; display: flex; align-items: center;"><input type="checkbox" class="improvement-checkbox" onchange="updateProgress()"><span style="margin-left: 8px;">参加情景规划工作坊（2天）</span></li>
                        <li style="margin-bottom: 8px; display: flex; align-items: center;"><input type="checkbox" class="improvement-checkbox" onchange="updateProgress()"><span style="margin-left: 8px;">在下一轮模拟中控制风险指数在40-60区间</span></li>
                        <li style="display: flex; align-items: center;"><input type="checkbox" class="improvement-checkbox" onchange="updateProgress()"><span style="margin-left: 8px;">每月召开跨部门战略协调会</span></li>
                    </ol>

                    <script>
                        function updateProgress() {
                            const checkboxes = document.querySelectorAll('.improvement-checkbox');
                            const completed = Array.from(checkboxes).filter(cb => cb.checked).length;
                            const total = checkboxes.length;
                            const percentage = Math.round((completed / total) * 100);
                            document.querySelector('.progress-title span:last-child').textContent = `${percentage}%`;
                            document.querySelector('.progress-fill').style.width = `${percentage}%`;
                        }

                        function updateDiagnosis() {
                            // 获取决策日志数据（示例数据，需根据实际决策逻辑调整）
                            const decisionLog = document.querySelectorAll('#decisionLog div');
                            const recentDecisions = Array.from(decisionLog).slice(-5);
                            const highRiskCount = recentDecisions.filter(decision => {
                                const riskIndex = parseInt(decision.textContent.match(/风险指数：(\d+)/)?.[1] || 0);
                                return riskIndex > 60;
                            }).length;

                            // 更新风险控制弱点描述
                            document.getElementById('riskControlDesc').textContent =
                                `过去5次决策中有${highRiskCount}次风险指数超过60，显示风险偏好较高`;

                            // 示例：更新长期战略弱点（需结合实际研发数据）
                            const rndInvestment = 25; // 假设当前研发投入占比
                            const benchmark = 40;
                            document.getElementById('strategyMissingDesc').textContent =
                                `研发投入占比（${rndInvestment}%）低于行业标杆企业（${benchmark}%）${benchmark - rndInvestment}个百分点`;

                            // 示例：更新团队协同弱点（需结合实际效率数据）
                            const collaborationScore = 75; // 假设当前效率评分
                            document.getElementById('collaborationDesc').textContent =
                                `跨部门决策执行效率评分提升至${collaborationScore}/100`;
                        }

                        // 在每次决策后调用更新诊断
                        function makeDecision(option) {
                            // 原有决策逻辑...
                            updateDiagnosis(); // 新增调用
                        }
                    </script>
                    
                    <div class="progress-container" style="margin-top: 15px;">
                        <div class="progress-title">
                            <span>改进计划完成度</span>
                            <span>0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>



                    <script>
                        // 新增抽题逻辑
                        async function loadQuiz() {
                            try {
                                const response = await fetch('/api/random-questions');
                                const questions = await response.json();
                                renderQuiz(questions);
                            } catch (error) {
                                console.error('获取题目失败:', error);
                                quizContainer.innerHTML = '<div class="error-msg">题目加载失败，请刷新页面重试</div>';
                            }
                        }

                        function renderQuiz(questions) {
                            const container = document.getElementById('quizContainer');
                            container.innerHTML = ''; // 清空原有内容
                            
                            questions.forEach((q, index) => {
                                const questionDiv = document.createElement('div');
                                questionDiv.className = 'quiz-question';
                                questionDiv.innerHTML = `
                                    <div class="question-content">${index + 1}. ${q.question_content}</div>
                                    <div class="quiz-options">${renderOptions(q)}</div>
                                    <div class="quiz-explanation" style="display:none;"></div>
                                `;
                                container.appendChild(questionDiv);
                            });
                        }

                        function renderOptions(q) {
                            let optionsHtml = '';
                            if (q.question_type === '判断题') {
                                optionsHtml = `
                                    <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                        <input type="radio" name="q${q.id}" value="正确"> 正确
                                    </label>
                                    <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                        <input type="radio" name="q${q.id}" value="错误"> 错误
                                    </label>
                                `;
                            } else {
                                Object.entries(q.options).forEach(([key, value]) => {
                                    optionsHtml += `
                                        <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                            <input type="radio" name="q${q.id}" value="${key}"> ${value}
                                        </label>
                                    `;
                                });
                            }
                            return optionsHtml;
                        }

                        // 初始化加载题目
                        document.querySelector('[onclick="switchTab(\'quiz\')"]').addEventListener('click', loadQuiz);
                    </script>
                </div>
            </div>
            
            <!-- 学习中心页 -->
            <div class="tab-content" id="knowledgeTab">
                <!-- 动态进度容器，通过JS更新 -->
                <div class="progress-container" data-category="strategy" style="margin: 15px 0;">
                    <div class="progress-title">
                        <span>战略管理</span>
                        <span class="progress-percent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>

                <div class="progress-container" data-category="change" style="margin: 15px 0;">
                    <div class="progress-title">
                        <span>变革管理</span>
                        <span class="progress-percent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>

                <div class="progress-container" data-category="risk" style="margin: 15px 0;">
                    <div class="progress-title">
                        <span>风险管理</span>
                        <span class="progress-percent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>
                <div class="knowledge-card">
                    <h3 class="section-title">推荐学习资源</h3>
                    
                    <div class="knowledge-category">
                        <div class="category-title">
                            <i>📖</i> 战略管理
                        </div>
                        <ul class="resource-list">
                            <li class="resource-item" style="display: flex; align-items: center; justify-content: flex-start;">
                                <span class="resource-icon">📘</span>
                                <a href="https://example.com/good-strategy" target="_blank">《好战略，坏战略》- 理查德·鲁梅尔特</a>
                                <div style="margin-left: auto; display: flex; align-items: center;">
                                    <span style="margin-right: 0;">是否完成</span>
                                    <input type="checkbox" class="resource-checkbox" data-category="strategy" oninput="updateLearningProgress()" style="margin-left: 0;">
                                </div>
                            </li>
                            <li class="resource-item" style="display: flex; align-items: center; justify-content: flex-start;">
                                <span class="resource-icon">🎧</span>
                                <a href="https://example.com/strategy-audio" target="_blank">"战略思维培养"音频课程</a>
                                <div style="margin-left: auto; display: flex; align-items: center;">
                                    <span style="margin-right: 0;">是否完成</span>
                                    <input type="checkbox" class="resource-checkbox" data-category="strategy" oninput="updateLearningProgress()" style="margin-left: 0;">
                                </div>
                            </li>
                            <li class="resource-item" style="display: flex; align-items: center; justify-content: flex-start;">
                                <span class="resource-icon">📽️</span>
                                <a href="https://example.com/huawei-case" target="_blank">华为战略管理实践案例</a>
                                <div style="margin-left: auto; display: flex; align-items: center;">
                                    <span style="margin-right: 0;">是否完成</span>
                                    <input type="checkbox" class="resource-checkbox" data-category="strategy" oninput="updateLearningProgress()" style="margin-left: 0;">
                                </div>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="knowledge-category">
                        <div class="category-title">
                            <i>🔄</i> 变革管理
                        </div>
                        <ul class="resource-list">
                            <li class="resource-item" style="display: flex; align-items: center; justify-content: flex-start;">
                                <span class="resource-icon">📘</span>
                                <a href="https://example.com/leading-change" target="_blank">《领导变革》- 约翰·科特</a>
                                <div style="margin-left: auto; display: flex; align-items: center;">
                                    <span style="margin-right: 0;">是否完成</span>
                                    <input type="checkbox" class="resource-checkbox" data-category="change" oninput="updateLearningProgress()" style="margin-left: 0;">
                                </div>
                            </li>
                            <li class="resource-item" style="display: flex; align-items: center; justify-content: flex-start;">
                                <span class="resource-icon">📽️</span>
                                <a href="https://example.com/microsoft-case" target="_blank">微软数字化转型案例研究</a>
                                <div style="margin-left: auto; display: flex; align-items: center;">
                                    <span style="margin-right: 0;">是否完成</span>
                                    <input type="checkbox" class="resource-checkbox" data-category="change" oninput="updateLearningProgress()" style="margin-left: 0;">
                                </div>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="knowledge-category">
                        <div class="category-title">
                            <i>📈</i> 风险管理
                        </div>
                        <ul class="resource-list">
                            <li class="resource-item" style="display: flex; align-items: center; justify-content: flex-start;">
                                <span class="resource-icon">📘</span>
                                <a href="https://example.com/black-swan" target="_blank">《黑天鹅》- 纳西姆·塔勒布</a>
                                <div style="margin-left: auto; display: flex; align-items: center;">
                                    <span style="margin-right: 0;">是否完成</span>
                                    <input type="checkbox" class="resource-checkbox" data-category="risk" oninput="updateLearningProgress()" style="margin-left: 0;">
                                </div>
                            </li>
                            <li class="resource-item" style="display: flex; align-items: center; justify-content: flex-start;">
                                <span class="resource-icon">📝</span>
                                <a href="https://example.com/risk-matrix" target="_blank">风险矩阵工具模板</a>
                                <div style="margin-left: auto; display: flex; align-items: center;">
                                    <span style="margin-right: 0;">是否完成</span>
                                    <input type="checkbox" class="resource-checkbox" data-category="risk" oninput="updateLearningProgress()" style="margin-left: 0;">
                                </div>
                            </li>
                        </ul>
                    </div>



                    <script>
                        // 新增抽题逻辑
                        async function loadQuiz() {
                            try {
                                const response = await fetch('/api/random-questions');
                                const questions = await response.json();
                                renderQuiz(questions);
                            } catch (error) {
                                console.error('获取题目失败:', error);
                                quizContainer.innerHTML = '<div class="error-msg">题目加载失败，请刷新页面重试</div>';
                            }
                        }

                        function renderQuiz(questions) {
                            const container = document.getElementById('quizContainer');
                            container.innerHTML = ''; // 清空原有内容
                            
                            questions.forEach((q, index) => {
                                const questionDiv = document.createElement('div');
                                questionDiv.className = 'quiz-question';
                                questionDiv.innerHTML = `
                                    <div class="question-content">${index + 1}. ${q.question_content}</div>
                                    <div class="quiz-options">${renderOptions(q)}</div>
                                    <div class="quiz-explanation" style="display:none;"></div>
                                `;
                                container.appendChild(questionDiv);
                            });
                        }

                        function renderOptions(q) {
                            let optionsHtml = '';
                            if (q.question_type === '判断题') {
                                optionsHtml = `
                                    <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                        <input type="radio" name="q${q.id}" value="正确"> 正确
                                    </label>
                                    <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                        <input type="radio" name="q${q.id}" value="错误"> 错误
                                    </label>
                                `;
                            } else {
                                Object.entries(q.options).forEach(([key, value]) => {
                                    optionsHtml += `
                                        <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                            <input type="radio" name="q${q.id}" value="${key}"> ${value}
                                        </label>
                                    `;
                                });
                            }
                            return optionsHtml;
                        }

                        // 初始化加载题目
                        document.querySelector('[onclick="switchTab(\'quiz\')"]').addEventListener('click', loadQuiz);
                    </script>
                </div>
                

            </div>
            
            <!-- 能力测试页 -->
            <div class="tab-content" id="quizTab">
                <div class="quiz-card">
                    <h3 class="section-title">战略决策能力测试</h3>
                    <div id="quizContainer" class="quiz-container"></div>  <!-- 题目容器 -->
                    <div class="quiz-actions">
                        <button class="quiz-btn" onclick="submitQuiz()">提交试卷</button>
                    </div>
                </div>
            </div>
            
            <!-- 能力档案页 -->
            <div class="tab-content" id="profileTab">
                <div class="profile-card">
                    <h3 class="section-title">战略能力评估</h3>
                    <div class="skill-radar">
                        <canvas id="radarChart"></canvas>
                    </div>



                    <script>
                        // 新增抽题逻辑
                        async function loadQuiz() {
                            try {
                                const response = await fetch('/api/random-questions');
                                const questions = await response.json();
                                renderQuiz(questions);
                            } catch (error) {
                                console.error('获取题目失败:', error);
                                quizContainer.innerHTML = '<div class="error-msg">题目加载失败，请刷新页面重试</div>';
                            }
                        }

                        function renderQuiz(questions) {
                            const container = document.getElementById('quizContainer');
                            container.innerHTML = ''; // 清空原有内容
                            
                            questions.forEach((q, index) => {
                                const questionDiv = document.createElement('div');
                                questionDiv.className = 'quiz-question';
                                questionDiv.innerHTML = `
                                    <div class="question-content">${index + 1}. ${q.question_content}</div>
                                    <div class="quiz-options">${renderOptions(q)}</div>
                                    <div class="quiz-explanation" style="display:none;"></div>
                                `;
                                container.appendChild(questionDiv);
                            });
                        }

                        function renderOptions(q) {
                            let optionsHtml = '';
                            if (q.question_type === '判断题') {
                                optionsHtml = `
                                    <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                        <input type="radio" name="q${q.id}" value="正确"> 正确
                                    </label>
                                    <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                        <input type="radio" name="q${q.id}" value="错误"> 错误
                                    </label>
                                `;
                            } else {
                                Object.entries(q.options).forEach(([key, value]) => {
                                    optionsHtml += `
                                        <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                            <input type="radio" name="q${q.id}" value="${key}"> ${value}
                                        </label>
                                    `;
                                });
                            }
                            return optionsHtml;
                        }

                        // 初始化加载题目
                        document.querySelector('[onclick="switchTab(\'quiz\')"]').addEventListener('click', loadQuiz);
                    </script>
                </div>
                
                <div class="profile-card">
                    <h3 class="section-title">能力成长轨迹</h3>
                    
                    <div class="skill-level">
                        <div class="skill-name">战略视野</div>
                        <div class="skill-bar">
                            <div class="skill-progress" style="width: 65%"></div>
                        </div>
                        <div class="skill-value">65</div>
                    </div>
                    
                    <div class="skill-level">
                        <div class="skill-name">风险控制</div>
                        <div class="skill-bar">
                            <div class="skill-progress" style="width: 45%"></div>
                        </div>
                        <div class="skill-value">45</div>
                    </div>
                    
                    <div class="skill-level">
                        <div class="skill-name">执行效率</div>
                        <div class="skill-bar">
                            <div class="skill-progress" style="width: 72%"></div>
                        </div>
                        <div class="skill-value">72</div>
                    </div>
                    
                    <div class="skill-level">
                        <div class="skill-name">创新思维</div>
                        <div class="skill-bar">
                            <div class="skill-progress" style="width: 58%"></div>
                        </div>
                        <div class="skill-value">58</div>
                    </div>
                    
                    <div class="skill-level">
                        <div class="skill-name">团队协作</div>
                        <div class="skill-bar">
                            <div class="skill-progress" style="width: 60%"></div>
                        </div>
                        <div class="skill-value">60</div>
                    </div>
                    
                    <div class="skill-level">
                        <div class="skill-name">财务敏锐</div>
                        <div class="skill-bar">
                            <div class="skill-progress" style="width: 68%"></div>
                        </div>
                        <div class="skill-value">68</div>
                    </div>



                    <script>
                        // 新增抽题逻辑
                        async function loadQuiz() {
                            try {
                                const response = await fetch('/api/random-questions');
                                const questions = await response.json();
                                renderQuiz(questions);
                            } catch (error) {
                                console.error('获取题目失败:', error);
                                quizContainer.innerHTML = '<div class="error-msg">题目加载失败，请刷新页面重试</div>';
                            }
                        }

                        function renderQuiz(questions) {
                            const container = document.getElementById('quizContainer');
                            container.innerHTML = ''; // 清空原有内容
                            
                            questions.forEach((q, index) => {
                                const questionDiv = document.createElement('div');
                                questionDiv.className = 'quiz-question';
                                questionDiv.innerHTML = `
                                    <div class="question-content">${index + 1}. ${q.question_content}</div>
                                    <div class="quiz-options">${renderOptions(q)}</div>
                                    <div class="quiz-explanation" style="display:none;"></div>
                                `;
                                container.appendChild(questionDiv);
                            });
                        }

                        function renderOptions(q) {
                            let optionsHtml = '';
                            if (q.question_type === '判断题') {
                                optionsHtml = `
                                    <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                        <input type="radio" name="q${q.id}" value="正确"> 正确
                                    </label>
                                    <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                        <input type="radio" name="q${q.id}" value="错误"> 错误
                                    </label>
                                `;
                            } else {
                                Object.entries(q.options).forEach(([key, value]) => {
                                    optionsHtml += `
                                        <label class="quiz-option" onclick="selectOption(this, ${q.id})">
                                            <input type="radio" name="q${q.id}" value="${key}"> ${value}
                                        </label>
                                    `;
                                });
                            }
                            return optionsHtml;
                        }

                        // 初始化加载题目
                        document.querySelector('[onclick="switchTab(\'quiz\')"]').addEventListener('click', loadQuiz);
                    </script>
                </div>
                
                <div class="profile-card">
                    <h3 class="section-title">能力证书</h3>
                    <p>完成以下学习目标可申请华博育士认证证书：</p>
                    <ul style="margin-top: 10px; padding-left: 20px;">
                        <li style="margin-bottom: 8px;">所有核心能力达到60分以上</li>
                        <li style="margin-bottom: 8px;">完成至少3门推荐课程</li>
                        <li style="margin-bottom: 8px;">通过最终能力评估</li>
                    </ul>
                    <button class="quiz-btn" style="margin-top: 15px;">申请能力认证</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 反馈弹窗 -->
    <div class="modal-overlay" id="feedbackModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">决策反馈</h3>
                <button class="modal-close" onclick="closeModal()">×</button>
            </div>
            <div class="modal-body" id="modalFeedbackContent">
                <!-- 反馈内容将通过JS动态填充 -->
            </div>
            <div class="modal-footer">
                <button class="quiz-btn" onclick="closeModal()">确认</button>
            </div>
        </div>
    </div>
    
    <!-- 音频元素 -->
    <audio id="positiveSound" src="https://assets.mixkit.co/sfx/preview/mixkit-positive-interface-beep-221.mp3" preload="auto"></audio>
    <audio id="negativeSound" src="https://assets.mixkit.co/sfx/preview/mixkit-warning-alarm-688.mp3" preload="auto"></audio>
    <audio id="neutralSound" src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3" preload="auto"></audio>
    <audio id="envSound" src="https://assets.mixkit.co/sfx/preview/mixkit-software-interface-start-2574.mp3" preload="auto"></audio>
    <audio id="successSound" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3" preload="auto"></audio>

    <script>
        // 游戏数据
        const gameData = {
            quarter: 1,
            year: 2023,
            budget: 50000000,
            marketShare: 32,
            revenue: 1200000000,
            profit: 180000000,
            riskIndex: 45,
            employeeSatisfaction: 75,
            decisions: [],
            trends: {
                quarters: ["Q1 2023"],
                marketShare: [32],
                revenue: [1200],
                profit: [180],
                risk: [45],
                satisfaction: [75]
            },
            companySize: 3,
            environment: "stable",
            buildings: [],
            skills: {
                vision: 65,
                riskControl: 45,
                execution: 72,
                innovation: 58,
                teamwork: 60,
                finance: 68
            },
            learningProgress: {
                strategy: 40,
                change: 15,
                risk: 25
            }
        };

        // 前端请求接口
async function loadRandomQuestions() {
    try {
        const response = await fetch('/api/random-questions');
        const questions = await response.json();
        renderQuestions(questions);
    } catch (error) {
        console.error('获取题目失败:', error);
    }
}

// 加载题目数据
async function loadQuizQuestions() {
    try {
        const response = await fetch('/api/random-questions');
        const questions = await response.json();
        renderQuizQuestions(questions);
    } catch (error) {
        console.error('加载题目失败:', error);
    }
}

// 渲染题目到页面
function renderQuizQuestions(questions) {
    const container = document.querySelector('#quizTab .quiz-container');
    container.innerHTML = '';  // 清空旧内容

    questions.forEach(question => {
        const card = document.createElement('div');
        card.className = 'quiz-card';
        
        // 题目内容
        const questionContent = document.createElement('div');
        questionContent.className = 'quiz-question';
        questionContent.textContent = question.question_content;
        card.appendChild(questionContent);

        // 选项渲染（根据题型）
        const optionsDiv = document.createElement('div');
        optionsDiv.className = 'quiz-options';
        
        if (question.question_type === '单项选择题') {
            Object.entries(question.options).forEach(([key, value]) => {
                const option = document.createElement('label');
                option.className = 'quiz-option';
                option.innerHTML = `
                    <input type="radio" name="q${question.id}" value="${key}">
                    ${key}. ${value}
                `;
                optionsDiv.appendChild(option);
            });
        } else if (question.question_type === '多项选择题') {
            Object.entries(question.options).forEach(([key, value]) => {
                const option = document.createElement('label');
                option.className = 'quiz-option';
                option.innerHTML = `
                    <input type="checkbox" name="q${question.id}" value="${key}">
                    ${key}. ${value}
                `;
                optionsDiv.appendChild(option);
            });
        } else if (question.question_type === '判断题') {
            ['正确', '错误'].forEach((text, index) => {
                const option = document.createElement('label');
                option.className = 'quiz-option';
                option.innerHTML = `
                    <input type="radio" name="q${question.id}" value="${index === 0 ? '√' : '×'}">
                    ${text}
                `;
                optionsDiv.appendChild(option);
            });
        }

        card.appendChild(optionsDiv);

        // 解析区域（初始隐藏）
        const explanation = document.createElement('div');
        explanation.className = 'quiz-explanation';
        explanation.textContent = `解析：${question.explanation}`;
        card.appendChild(explanation);

        container.appendChild(card);
    });
}

        // 音频元素
        const positiveSound = document.getElementById('positiveSound');
        const negativeSound = document.getElementById('negativeSound');
        const neutralSound = document.getElementById('neutralSound');
        const envSound = document.getElementById('envSound');
        const successSound = document.getElementById('successSound');

        // 图表实例
        let trendChart, radarChart;
        
        // 初始化游戏
        document.addEventListener('DOMContentLoaded', function() {
            initCharts();
            updateBuildings();
            updateUI();
            updateDecisionLog();
            
            // 加载题目
            loadRandomQuestions();
            
            // 随机环境变化
            setInterval(randomEnvironmentChange, 20000);
        });

        // 初始化图表
        function initCharts() {
            // 雷达图
            const radarCtx = document.getElementById('radarChart').getContext('2d');
            radarChart = new Chart(radarCtx, {
                type: 'radar',
                data: {
                    labels: ['战略视野', '风险控制', '执行效率', '创新思维', '团队协作', '财务敏锐'],
                    datasets: [{
                        label: '能力评估',
                        data: [
                            gameData.skills.vision,
                            gameData.skills.riskControl,
                            gameData.skills.execution,
                            gameData.skills.innovation,
                            gameData.skills.teamwork,
                            gameData.skills.finance
                        ],
                        backgroundColor: 'rgba(58, 123, 213, 0.2)',
                        borderColor: 'rgba(58, 123, 213, 1)',
                        pointBackgroundColor: 'rgba(58, 123, 213, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(58, 123, 213, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: {
                                color: 'rgba(0,0,0,0.1)'
                            },
                            suggestedMin: 0,
                            suggestedMax: 100,
                            ticks: {
                                stepSize: 20
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // 切换标签页
        function switchTab(tabId) {
    // 更新标签按钮状态
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector(`.tab-btn[onclick="switchTab('${tabId}')"]`).classList.add('active');
    
    // 更新内容显示
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
    });
    document.getElementById(`${tabId}Tab`).classList.add('active');
    
    // 如果是能力档案页，更新雷达图
    if (tabId === 'profile') {
        updateRadarChart();
    }
    // 切换到能力测试时加载题目
    if (tabId === 'quiz') {
        loadQuizQuestions();
    }
}

        // 做出决策
        function makeDecision(option) {
            // 根据决策更新游戏状态
            const result = updateGameState(option);
            
            // 显示反馈
            showFeedback(option, result);
            
            // 进入下一季度
            nextQuarter();
            
            // 更新UI
            updateUI();
            
            // 更新决策日志
            updateDecisionLog();
            
            // 播放音效
            playFeedbackSound(result.effect);
            
            // 更新能力值
            updateSkills(option, result);
        }

        // 更新游戏状态
        function updateGameState(option) {
            let marketShareChange = 0;
            let revenueChange = 0;
            let profitChange = 0;
            let riskChange = 0;
            let satisfactionChange = 0;
            let cost = 0;
            let effect = 'neutral'; // positive, negative, neutral
            let feedback = '';
            
            // 环境影响因子
            let envFactor = 1;
            if (gameData.environment === 'growth') envFactor = 1.2;
            if (gameData.environment === 'recession') envFactor = 0.8;
            
            switch(option) {
                case 1: // 加大研发投入
                    cost = 15000000;
                    marketShareChange = (-2 + Math.random() * 6) * envFactor;
                    revenueChange = (-5 + Math.random() * 10) * envFactor;
                    profitChange = (-15 + Math.random() * 10) * envFactor; // 调整波动范围为-15~-5
                    riskChange = (10 + Math.random() * 10) * envFactor;
                    satisfactionChange = (3 + Math.random() * 4) * envFactor; // 调整波动范围为3~7
                    feedback = "研发投入将增强长期竞争力，但短期利润压力增大。";
                    effect = marketShareChange > 2 ? 'positive' : (profitChange < -15 ? 'negative' : 'neutral');
                    break;
                case 2: // 并购竞争对手
                    cost = 30000000;
                    marketShareChange = (3 + Math.random() * 8) * envFactor;
                    revenueChange = (10 + Math.random() * 20) * envFactor;
                    profitChange = (-20 + Math.random() * 15) * envFactor; // 调整波动范围为-20~-5
                    riskChange = (20 + Math.random() * 15) * envFactor;
                    satisfactionChange = (-8 + Math.random() * 12) * envFactor; // 调整波动范围为-8~4
                    feedback = "并购快速扩大了市场份额，但整合挑战不容忽视。";
                    effect = marketShareChange > 5 ? 'positive' : (profitChange < -20 ? 'negative' : 'neutral');
                    break;
                case 3: // 优化现有产品线
                    cost = 5000000;
                    marketShareChange = (-3 + Math.random() * 4) * envFactor;
                    revenueChange = (-5 + Math.random() * 5) * envFactor;
                    profitChange = (10 + Math.random() * 8) * envFactor; // 调整波动范围为10~18
                    riskChange = (-5 + Math.random() * 5) * envFactor;
                    satisfactionChange = (-10 + Math.random() * 8) * envFactor; // 调整波动范围为-10~-2
                    feedback = "成本削减改善了短期利润，但可能影响员工士气。";
                    effect = profitChange > 15 ? 'positive' : (satisfactionChange < -10 ? 'negative' : 'neutral');
                    break;
                case 4: // 开拓新兴市场
                    cost = 20000000;
                    marketShareChange = (1 + Math.random() * 10) * envFactor;
                    revenueChange = (5 + Math.random() * 25) * envFactor;
                    profitChange = (-8 + Math.random() * 14) * envFactor; // 调整波动范围为-8~6
                    riskChange = (15 + Math.random() * 10) * envFactor;
                    satisfactionChange = (2 + Math.random() * 6) * envFactor; // 调整波动范围为2~8
                    feedback = "新兴市场带来增长机会，但初期投入较大。";
                    effect = revenueChange > 15 ? 'positive' : (profitChange < -10 ? 'negative' : 'neutral');
                    break;
            }
            
            // 应用变化
            gameData.budget -= cost;
            gameData.marketShare = Math.max(5, Math.min(100, gameData.marketShare + marketShareChange));
            gameData.revenue = Math.max(200000000, gameData.revenue * (1 + revenueChange/100));
            gameData.profit = Math.max(0, gameData.profit * (1 + profitChange/100));
            gameData.riskIndex = Math.max(10, Math.min(100, gameData.riskIndex + riskChange));
            gameData.employeeSatisfaction = Math.max(30, Math.min(100, gameData.employeeSatisfaction + satisfactionChange));
            
            // 更新公司规模 (根据营收增长)
            const growthFactor = (gameData.revenue / 1200000000) - 1; // 相对于初始1.2B的增长
            gameData.companySize = Math.max(1, Math.min(10, Math.floor(3 + growthFactor * 5)));
            
            // 记录决策
            const decision = {
                quarter: `Q${gameData.quarter} ${gameData.year}`,
                option: option,
                marketShareChange: marketShareChange,
                revenueChange: revenueChange,
                profitChange: profitChange,
                riskChange: riskChange,
                effect: effect
            };
            gameData.decisions.push(decision);
            
            return {
                effect: effect,
                feedback: feedback,
                marketShareChange: marketShareChange,
                revenueChange: revenueChange,
                profitChange: profitChange,
                riskChange: riskChange,
                satisfactionChange: satisfactionChange
            };
        }

        // 更新能力值
        function updateSkills(option, result) {
            // 根据决策类型和能力影响更新技能值
            switch(option) {
                case 1: // 研发投入
                    gameData.skills.innovation = Math.min(100, gameData.skills.innovation + 2);
                    gameData.skills.vision = Math.min(100, gameData.skills.vision + 1);
                    gameData.skills.riskControl = Math.max(0, gameData.skills.riskControl - 1);
                    break;
                case 2: // 并购
                    gameData.skills.execution = Math.min(100, gameData.skills.execution + 1);
                    gameData.skills.finance = Math.min(100, gameData.skills.finance + 1);
                    gameData.skills.riskControl = Math.max(0, gameData.skills.riskControl - 2);
                    break;
                case 3: // 优化
                    gameData.skills.finance = Math.min(100, gameData.skills.finance + 2);
                    gameData.skills.teamwork = Math.max(0, gameData.skills.teamwork - 1);
                    break;
                case 4: // 新兴市场
                    gameData.skills.vision = Math.min(100, gameData.skills.vision + 2);
                    gameData.skills.riskControl = Math.min(100, gameData.skills.riskControl + 1);
                    break;
            }
            
            // 根据结果调整能力值
            if (result.effect === 'positive') {
                gameData.skills.execution = Math.min(100, gameData.skills.execution + 1);
                gameData.skills.teamwork = Math.min(100, gameData.skills.teamwork + 1);
            } else if (result.effect === 'negative') {
                gameData.skills.riskControl = Math.max(0, gameData.skills.riskControl - 1);
            }
            
            // 更新学习进度
            if (option === 1 || option === 4) {
                gameData.learningProgress.strategy = Math.min(100, gameData.learningProgress.strategy + 5);
            }
            if (option === 2) {
                gameData.learningProgress.change = Math.min(100, gameData.learningProgress.change + 5);
            }
            if (option === 3) {
                gameData.learningProgress.risk = Math.min(100, gameData.learningProgress.risk + 5);
            }
        }

        // 进入下一季度
        function nextQuarter() {
            gameData.quarter++;
            if (gameData.quarter > 4) {
                gameData.quarter = 1;
                gameData.year++;
                
                // 每年随机环境变化
                randomEnvironmentChange(true);
                
                // 每年生成诊断报告
                if (gameData.year > 2023) {
                    setTimeout(() => {
                        showAnnualReport();
                    }, 1000);
                }
            }
            
            // 更新趋势数据
            gameData.trends.quarters.push(`Q${gameData.quarter} ${gameData.year}`);
            gameData.trends.marketShare.push(Math.round(gameData.marketShare));
            gameData.trends.revenue.push(Math.round(gameData.revenue / 1000000));
            gameData.trends.profit.push(Math.round(gameData.profit / 1000000));
            gameData.trends.risk.push(Math.round(gameData.riskIndex));
            gameData.trends.satisfaction.push(Math.round(gameData.employeeSatisfaction));
            
            // 更新公司建筑
            updateBuildings();
        }

        // 更新UI
        function updateUI() {
            document.getElementById('marketShare').textContent = `${Math.round(gameData.marketShare)}%`;
            document.getElementById('revenue').textContent = `¥${formatNumber(gameData.revenue)}`;
            document.getElementById('profit').textContent = `¥${formatNumber(gameData.profit)}`;
            document.getElementById('riskIndex').textContent = Math.round(gameData.riskIndex);
            
            // 更新情景文本
            updateScenarioText();
        }

        // 更新公司建筑可视化
        function updateBuildings() {
            const companyVisual = document.getElementById('companyVisual');
            
            // 清除现有建筑
            companyVisual.innerHTML = '';
            gameData.buildings = [];
            
            // 创建新建筑
            const buildingCount = Math.max(3, Math.min(7, gameData.companySize));
            const mainTowerIndex = Math.floor(buildingCount / 2);
            
            for (let i = 0; i < buildingCount; i++) {
                const isMainTower = i === mainTowerIndex;
                const height = isMainTower ? 
                    80 + (gameData.companySize * 10) : 
                    40 + (gameData.companySize * 5) + (Math.random() * 20 - 10);
                
                const building = document.createElement('div');
                building.className = `building ${isMainTower ? 'main-tower' : ''}`;
                building.style.height = `${height}px`;
                
                // 创建窗户
                const windowCount = Math.floor(height / 15) * 2;
                const windows = document.createElement('div');
                windows.className = 'building-windows';
                
                for (let j = 0; j < windowCount; j++) {
                    const window = document.createElement('div');
                    window.className = 'window';
                    windows.appendChild(window);
                }
                
                building.appendChild(windows);
                companyVisual.appendChild(building);
                gameData.buildings.push(building);
                
                // 随机点亮窗户
                setTimeout(() => {
                    const windowElements = building.querySelectorAll('.window');
                    windowElements.forEach(w => {
                        if (Math.random() > 0.3) { // 70%的窗户亮着
                            w.style.backgroundColor = '#ffeaa7';
                            w.style.boxShadow = '0 0 5px #ffeaa7';
                        }
                    });
                }, 100);
            }
            
            // 如果公司规模很大，显示庆祝效果
            if (gameData.companySize >= 8) {
                showCelebration();
            }
        }

        // 更新决策日志
        function updateDecisionLog() {
            const logContainer = document.getElementById('decisionLog');
            logContainer.innerHTML = '';
            
            // 只显示最近5条决策
            const recentDecisions = gameData.decisions.slice(-5).reverse();
            
            recentDecisions.forEach(decision => {
                const logEntry = document.createElement('div');
                logEntry.style.padding = '5px 0';
                logEntry.style.borderBottom = '1px solid #f0f0f0';
                
                const optionName = getOptionName(decision.option);
                const effectIcon = decision.effect === 'positive' ? '✅' : decision.effect === 'negative' ? '❌' : '➖';
                
                logEntry.innerHTML = `
                    <strong>${decision.quarter}</strong>: ${optionName} 
                    <span style="float: right;">${effectIcon}</span>
                    <div style="font-size: 0.8rem; color: #666;">
                        市场份额: ${decision.marketShareChange > 0 ? '+' : ''}${decision.marketShareChange.toFixed(1)}% | 
                        风险指数: ${decision.riskChange > 0 ? '+' : ''}${decision.riskChange.toFixed(1)}
                    </div>
                `;
                
                logContainer.appendChild(logEntry);
            });
        }

        // 更新雷达图
        function updateRadarChart() {
            radarChart.data.datasets[0].data = [
                gameData.skills.vision,
                gameData.skills.riskControl,
                gameData.skills.execution,
                gameData.skills.innovation,
                gameData.skills.teamwork,
                gameData.skills.finance
            ];
            radarChart.update();
        }

        // 随机环境变化
        function randomEnvironmentChange(isAnnual = false) {
            if (Math.random() > 0.5 || isAnnual) {
                const environments = [
                    { type: "stable", name: "稳定", message: "经济环境回归稳定状态" },
                    { type: "growth", name: "增长", message: "经济进入增长期！市场需求旺盛" },
                    { type: "recession", name: "衰退", message: "经济衰退开始，市场收缩" }
                ];
                
                const newEnv = environments[Math.floor(Math.random() * environments.length)];
                if (newEnv.type !== gameData.environment) {
                    gameData.environment = newEnv.type;
                    
                    // 显示环境变化提示
                    const envChange = document.getElementById('envChange');
                    envChange.textContent = newEnv.message;
                    envChange.style.display = 'block';
                    
                    // 播放环境变化音效
                    envSound.play();
                    
                    // 3秒后隐藏提示
                    setTimeout(() => {
                        envChange.style.display = 'none';
                    }, 3000);
                    
                    // 添加到决策日志
                    const logEntry = document.createElement('div');
                    logEntry.style.padding = '5px 0';
                    logEntry.style.color = newEnv.type === 'growth' ? '#4CAF50' : newEnv.type === 'recession' ? '#F44336' : '#2196F3';
                    logEntry.innerHTML = `<strong>环境变化</strong>: ${newEnv.message}`;
                    document.getElementById('decisionLog').prepend(logEntry);
                }
            }
        }

        // 显示反馈弹窗
        function showFeedback(option, result) {
            const modal = document.getElementById('feedbackModal');
            const content = document.getElementById('modalFeedbackContent');
            
            let fullFeedback = result.feedback;
            
            // 添加环境影响的说明
            if (gameData.environment === 'growth') {
                fullFeedback += "<br><br>经济处于增长期，市场对创新举措反应积极！";
            } else if (gameData.environment === 'recession') {
                fullFeedback += "<br><br>经济衰退影响了决策效果，消费者支出减少。";
            }
            
            // 添加具体数据变化
            fullFeedback += `<br><br><strong>影响结果:</strong>
                <br>• 市场份额: ${result.marketShareChange > 0 ? '+' : ''}${result.marketShareChange.toFixed(1)}%
                <br>• 营收: ${result.revenueChange > 0 ? '+' : ''}${result.revenueChange.toFixed(1)}%
                <br>• 利润: ${result.profitChange > 0 ? '+' : ''}${result.profitChange.toFixed(1)}%
                <br>• 风险指数: ${result.riskChange > 0 ? '+' : ''}${result.riskChange.toFixed(1)}`;
            
            // 添加能力提升提示
            if (option === 1 || option === 4) {
                fullFeedback += "<br><br><strong>能力提升:</strong> 战略视野 +1，创新思维 +2";
            } else if (option === 2) {
                fullFeedback += "<br><br><strong>能力提升:</strong> 执行效率 +1，财务敏锐 +1";
            }
            
            content.innerHTML = fullFeedback;
            modal.style.display = 'flex';
        }

        // 显示年度报告
        function showAnnualReport() {
            const modal = document.getElementById('feedbackModal');
            const content = document.getElementById('modalFeedbackContent');
            
            let report = `<h3 style="color: var(--hby-orange); margin-bottom: 10px;">${gameData.year-1}年度战略决策报告</h3>`;
            
            // 年度总结
            const revenueGrowth = ((gameData.revenue - 1200000000) / 1200000000 * 100).toFixed(1);
            const profitGrowth = ((gameData.profit - 180000000) / 180000000 * 100).toFixed(1);
            
            report += `<p><strong>年度业绩:</strong>
                <br>• 营收增长: ${revenueGrowth > 0 ? '+' : ''}${revenueGrowth}%
                <br>• 利润增长: ${profitGrowth > 0 ? '+' : ''}${profitGrowth}%
                <br>• 平均风险指数: ${calculateAverage(gameData.trends.risk).toFixed(1)}</p>`;
            
            // 决策分析
            report += `<p><strong>决策模式分析:</strong>`;
            
            const riskDecisions = gameData.decisions.filter(d => d.option === 2 || d.option === 4).length;
            if (riskDecisions > 3) {
                report += "<br>• 高风险决策占比过高，建议加强风险评估";
            }
            
            const profitFocus = gameData.decisions.filter(d => d.option === 3).length;
            if (profitFocus > 2) {
                report += "<br>• 过度关注短期利润，可能影响长期竞争力";
            }
            
            // 能力发展建议
            report += `<p><strong>能力发展建议:</strong>
                <br>• 当前风险控制能力: ${gameData.skills.riskControl}/100
                <br>• 建议完成风险管理课程和情景规划训练</p>`;
            
            content.innerHTML = report;
            modal.style.display = 'flex';
        }

        // 计算平均值
        function calculateAverage(arr) {
            return arr.reduce((a, b) => a + b, 0) / arr.length;
        }

        // 关闭弹窗
        function closeModal() {
            document.getElementById('feedbackModal').style.display = 'none';
        }

        // 播放反馈音效
        function playFeedbackSound(type) {
            switch(type) {
                case 'positive':
                    positiveSound.play();
                    break;
                case 'negative':
                    negativeSound.play();
                    break;
                default:
                    neutralSound.play();
            }
        }

        // 显示庆祝效果
        function showCelebration() {
            // 播放成功音效
            successSound.play();
            
            // 创建彩色纸屑效果
            for (let i = 0; i < 30; i++) {
                createConfetti();
            }
        }

        // 创建彩色纸屑
        function createConfetti() {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            
            // 随机颜色
            const colors = ['#FF6B35', '#004E89', '#4CAF50', '#FFC107', '#9C27B0'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.backgroundColor = randomColor;
            
            // 随机位置
            confetti.style.left = `${Math.random() * 100}%`;
            confetti.style.width = `${5 + Math.random() * 10}px`;
            confetti.style.height = `${5 + Math.random() * 10}px`;
            
            // 随机动画延迟
            confetti.style.animationDelay = `${Math.random() * 0.5}s`;
            
            document.body.appendChild(confetti);
            
            // 动画结束后移除
            setTimeout(() => {
                confetti.remove();
            }, 3000);
        }

        // 更新情景文本
        function updateScenarioText() {
            const scenarios = [
                "公司面临市场份额连续三个季度下滑，竞争对手推出了颠覆性产品，董事会要求立即采取行动扭转局面。",
                "经济环境不确定性增加，投资者对公司增长前景表示担忧，要求更清晰的战略路线图。",
                "关键技术人才被竞争对手挖角，同时新产品开发进度落后于计划。",
                "监管环境发生变化，影响了公司核心业务的盈利模式，需要战略调整。",
                "公司成功上市后，面临更大的业绩压力和公众监督，需要平衡短期目标与长期战略。",
                "新兴技术崛起可能颠覆行业，公司需要决定是引领变革还是巩固现有优势。",
                "全球供应链中断导致生产成本上升，需要重新评估生产和分销策略。",
                "主要客户要求大幅降价，否则将转向竞争对手，面临利润率压力。"
            ];
            
            const randomScenario = scenarios[Math.floor(Math.random() * scenarios.length)];
            document.getElementById('scenarioText').textContent = randomScenario;
        }

        // 获取决策选项名称
        function getOptionName(option) {
            switch(option) {
                case 1: return '研发投入';
                case 2: return '并购';
                case 3: return '优化产品';
                case 4: return '新兴市场';
                default: return '未知';
            }
        }

        // 选择题选项选择
        function selectOption(element) {
            // 移除同题目其他选项的选中状态
            const options = element.parentElement.querySelectorAll('.quiz-option');
            options.forEach(opt => {
                opt.classList.remove('selected');
            });
            // 添加当前选项的选中状态
            element.classList.add('selected');
        }
        // 检查答案
        function checkAnswer() {
            // 在实际应用中，这里会验证答案并给出反馈
            alert("答案已提交！系统将记录您的学习进度。");
        }

        // 显示解析
        function showExplanation(id) {
            const explanation = document.getElementById(id);
            if (explanation.style.display === 'none') {
                explanation.style.display = 'block';
            } else {
                explanation.style.display = 'none';
            }
        }

        // 格式化数字显示
        function formatNumber(num) {
            if (num >= 100000000) {
                return (num / 100000000).toFixed(1) + '亿';
            } else if (num >= 10000) {
                return (num / 10000).toFixed(1) + '万';
            }
            return num.toLocaleString();
        }
    </script>
</body>
</html>